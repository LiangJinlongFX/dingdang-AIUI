## 基于叮当——中文语音对话机器人框架修改备忘

### 说明

+ 语音唤醒使用 Pocketsphinx 离线语音识别引擎
  + 修改唤醒词
+ 主动语音识别使用 REST API 百度在线语音识别服务
  + 配置接入参数
  + 优化在线识别词语
+ 声音播放
  + 使用mic.say() 封装的 TTS 使用百度在线语音合成服务，默认返回MP3格式音频，通过调用shell 命令：aplay播放音频，
  + 在外设板设置了一个"stop play"按键来终止一切 "play" 进程
+ 智能对话
  + 使用科大讯飞的AIUI

### 二维码扫描

+ 手机扫描二维码时镜头不直对着屏幕正面，要与镜面倾斜一定角度并保持一定距离才能有效地捕捉到二维码

### 微信

+ 由于账号的问题，发送给账号本身不可用，应发送给 filehelper

   ~~~python
     文件传输助手id说明：
     user_id = u'filehelper'
     to_user_id = u'filehelper'
   ~~~

### 系统检测程序说明（button.py）

+ 增大音量键

  ​	系统音量在相对基础上增加10dB

+ 减少音量键

  ​	系统音量在相对基础上增加10dB

+ 系统电源键

  + 按一下：未定义，

  + 按两下：重启程序，红灯闪烁，10秒后执行

  + 按三下：系统重启，粉灯闪烁，10秒后执行

  + 按四下：系统关机，白灯闪烁，10秒后执行

  + 按四次以上，取消当前操作，绿灯静默

    **按键次数累计**

  ### RGB灯显示说明

+ LED2

  + 红灯,用于录音指示，处于录音状态则红灯亮起

### 通知功能说明

​	使用Advanced Python Scheduler异步执行通知检索进程，定时检测是否有通知消息

#### 邮件通知

​	通知邮箱未读邮件状况

#### 微信消息通知

#### 临期备忘通知

​	当备忘录的备忘截止时间到了，系统提取临期备忘的详细内容并播报出来，然后把过期的备忘给删除掉

### 系统功能说明

#### 备忘功能

- 备忘录清单查看

  关键词：查看备忘/检查备忘/备忘录

  描述： 触发此功能后机器人从Taskwarrior 提取当前备忘录列表，并逐条播报备忘的内容和截止时间

- 添加备忘条目

  关键字：添加备忘xxx

  **该功能需用空格分隔有效字符串 应使用微信文字录入**

  描述： 该功能指令有效格式为“ 添加备忘 20180821 提醒宝宝看书”，机器人从中提取有效字符串并写入备忘录里面，并播报：“添加备忘成功”；若录入格式错误或者其他异常则播报：“添加备忘失败”

#### 拍照

+ 机器人拍照并上传到邮箱/微信文件传输助手

  关键字：拍照/拍张照

  **需机器人接入USB摄像头**

  描述：触发此功能后，机器人播报并进行3秒拍照倒计时，拍照成功的话会进入发送环节，发送照片到邮箱或者微信，发送成功机器人播报：“发送成功“，否则播报失败；若没配置摄像头，机器人不能有效触发此功能

#### 时间

+ 询问当前时间

  关键字：时间/几点/多少点

  描述：触发此功能后，系统通过NTP(Network Time Protocol )获取当前时间并语音播报出来

#### 邮件

+ 查看邮箱的未读邮件情况

  关键字：邮箱/邮件

  描述：触发此功能后，机器人会检查已配置邮箱的未读邮件状况，并语音播报出来

#### 清空缓存

+ 清空系统缓存的临时文件和聊天记录

  关键字：清除缓存/清空缓存

  描述：触发此功能后，机器人会清空缓存目录下的所有文件，包括缓存的语音数据和聊天记录

#### 系统控制

+ 关闭系统

  关键字：关机/关闭系统

  描述：触发此功能后，系统会给与语音提示，请在滴一声后回复关键字”确认/好/是/OK“以允许系统进一步操作，回复关键字以外的指令则取消操作

+ 重启系统

  关键字：重启/重启系统

  描述：触发此功能后，系统会给与语音提示，请在滴一声后回复关键字”确认/好/是/OK“以允许系统进一步操作，回复关键字以外的指令则取消操作

+ 增加系统音量

  关键字：大声点/增大音量

  描述：触发此功能后，成功增加系统音量

+ 减少系统音量

  关键字：小声点/减少音量

  描述：触发此功能后，成功减少系统音量

+ 查看系统运行状况

  关键字：树莓派状态/运行状态

  描述：触发此功能后，系统会读取RAM/SD/IP地址等相关参数，并在OLED显示屏上呈现5秒左右

#### 语音录入方式切换

+ 进入按键触发录音方式

  关键字：闲聊/聊天

  描述：触发此功能后，机器人不必经唤醒后进入主动倾听状态，但是通过按钮来控制录音开始与终止

+ 进入静默监听状态

  关键字：不聊了/结束/停止/退出

  描述：触发此功能后，机器人恢复静默监听状态，经语音唤醒后才进入主动录音状态，优点是不用按键就可以完成录音动作

#### 音乐播放

+ 播放音乐

  关键字：听歌/听儿歌/播放音乐/听音乐

  描述：触发此功能后，系统会检索百度FM频道歌单的URL链接或者本地的音乐目录（优先从本地歌单中播放），检索完成后机器人播报歌曲名称并开始播放；若当前已经在播放歌曲中此指令无效

+ 切换歌曲

  关键字：上一首/换歌/下一首

  描述：若当前未处于音乐播放中此指令无效

+ 关闭音乐

  关键字：不听了/关闭音乐

  描述：删除所有播放音乐的进程

#### 微信留言

+ 录取音频并发送到登录的微信文件传输助手

  **此功能仅在登录微信后有效**

  关键字：微信留言

  描述：触发此功能后系统会提示录音，系统获取音频数据后发送给微信文件传输助手，无论发送成功与否，都会有提示

#### 翻译

+ 将某个句子中译英或者英译中

  关键字：翻译XXX

  描述：触发此功能后，从指令中截取要翻译的字符串，通过有道翻译API返回翻译后的结果并语音播报处理，若指令格式有误或其他异常则语音报错

#### 微软小冰

+ 机器人与微信小冰公众号交互

  关键字：女神/小冰/小兵

  描述：触发此功能后，系统将会处于与小冰公众号交互中，通过按钮激活录音并将识别到的文本发送到当前微信上的小冰公众号上，系统接受小冰的文本和语音响应，将文本合成语音播报出来，接收到的音频则直接播放出来

#### AIUI

**通过科大讯飞AIUI提供人机交互解决方案**

**未被以上功能情景有效触发的指令均交由AIUI解析**

+ 诗词处理

  触发短语：来一首李白的静夜思/白日依山尽的下一句/李清照

  描述：

+ 时间

  触发短语：今天星期几

+ 天气